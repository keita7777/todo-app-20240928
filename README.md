# アプリケーション情報

## デプロイ URL

https://todo-app-20240928.vercel.app/

## GitHub

https://github.com/keita7777/todo-app-20240928.git

## テストユーザー

### メールアドレス

test@gmail.com

### パスワード

12345

<br><br>
新規ユーザー登録、新規 TODO 作成、既存 TODO 削除などなんでもやっていただいて問題ありません。

# ページ構成

## TODO

ログインしていない場合/signin へリダイレクト（middleware.ts にリダイレクト処理記述）

- TODO 一覧（/todos）
- TODO 新規作成（/todos/create）
- TODO 詳細（/todos/[id]）

<br>
ログインユーザーが作成者でない場合は/todos/[id]へリダイレクト（app\(todo)\todos\[id]\edit\page.tsx にリダイレクト処理記述）

- TODO 編集（/todos/[id]/edit）

## ユーザー

ログインしていない場合/signin へリダイレクト（middleware.ts にリダイレクト処理記述）

- プロフィール（/profile）

## 認証

ログインしている場合/todos へリダイレクト（app/(auth)\layout.tsx にリダイレクト処理記述）

- ログイン（/signin）
- 新規ユーザー登録（/signup）

## ホーム画面（/）

本来何かしらホーム画面を作る（もしくは TODO 一覧をホーム画面にする）べきだと思うが、今回は認証状態によってリダイレクトさせ、ホーム画面は表示されないようにしている

# 使用技術

## プログラミング言語

- TypeScript

## フレームワーク

- Next.js

## ライブラリ

### 認証

- Auth.js
- bcryptjs

### フォーム管理

- React Hook From

### バリデーション

- zod

### ORM

- Prisma

### UI 全般

- Tailwind
- react-icons

## データベース

- Supabase

## インフラ

- Vercel

## バージョン管理

- Git/GitHub

# 各画面の機能

## ヘッダー

- 認証状態によって表示する要素を切り替え
- タイトル検索
  <br>テキストを入力して検索をクリックすると/todos に遷移し、入力したテキストが含まれる TODO が表示される
  <br>検索状態にあるとき（URL に query=XXX があるとき）のみ「検索条件をリセット」ボタンが表示される
- プロフィール画像クリックでメニュー開閉

## TODO 一覧（/todos）

- TODO 一覧の取得
- ページネーション
- ステータスによるフィルター
- 日付の降順/昇順切り替え（デフォルトは降順）
- 各 TODO をクリックすると詳細ページへ遷移

## TODO 新規作成（/todos/create）

- タイトル、詳細、ステータスを入力/選択して登録をクリックするとデータベースに保存され、/todos に遷移する
- リセットをクリックすると、入力した内容がリセットされる

## TODO 詳細（/todos/[id]）

- TODO の詳細情報および作成者のユーザー名が表示される
- 編集をクリックすると/todos/[id]/edit に遷移する
- 削除をクリックするとモーダルウィンドウが開く
  <br>モーダルウィンドウの削除をクリックするとデータベースから TODO が削除される
  <br>キャンセルをクリックするとモーダルウィンドウが閉じる

## TODO 編集（/todos/[id]/edit）

- TODO 作成者のみアクセスできる
- 更新をクリックすると入力された情報でデータベースを更新する
- キャンセルをクリックすると詳細ページに遷移する

## プロフィール（/profile）

- ヘッダーのプロフィール画像をクリックして表示されるメニューから遷移できる
- ログインしているユーザーの情報を表示する
  <br>ユーザー名とログイン日時のみ

## ログイン（/signin）

- Credentials 認証
- 実装方法は Auth.js 公式サイトを参考にした（https://authjs.dev/getting-started/installation）

## 新規ユーザー登録（/signup）

- パスワードはハッシュ化したうえでデータベースに保存（bcryptjs を使用）

# 未実装の機能

今後追加するかもしれませんが、現時点では実装していません。

- OAuth 認証
- コメント機能
- プロフィール画像のアップロード

# 気になる点・不具合

## TODO 作成後の挙動

formState.isSubmitSuccessful で状態を判定し、送信完了後はフォームを非表示にしています。<br>この処理は、送信完了後/todos へ遷移する前に、活性化されたフォームが一瞬表示されてしまう挙動を修正するために追加しました。
<br><br>
現在の挙動の流れは以下のようになっています
<br>
1:「登録」をクリック<br>
2:フォームが非活性になる<br>
3:画面が真っ白になる<br>
4:/todos へ遷移する<br>
<br>
想定通りの挙動ではあるのですが、3 の状態が目立つのが気になります。
できれば 3 は飛ばして、送信完了したらすぐに/todos へ遷移するようにしたいです。
<br><br>
※編集フォーム、ログインフォームも同様の不具合

## フィルター、ソート、ページネーション実行時のローディング

app\(todo)\todos\page.tsx にて TodoList コンポーネントは Suspense で囲み、ローディング中は「ローディング中...」と表示されるようにしています。
<br><br>
ただこのローディングは\todos を初回読み込み時のみ表示され、フィルター、ソート、ページネーションを使用した際はローディングが表示されません。（フィルターボタンクリック後、一定時間経ってから画面が切り替わる）
<br><br>
フィルター、ソート、ページネーションを使用するたびにローディングを表示させるにはどうすればよいでしょうか？
<br>
そもそも挙動が遅すぎるのも問題でしょうか？

## エラーハンドリング

認証や TODO 作成などデータベースとのやり取りが必要な処理は「lib\actions.ts」にまとめています
<br>
try catch の使用、エラーの返し方/受け取り方が適切か、などエラーハンドリングについてよく理解できていません。
<br>
エラーハンドリングが適切か見ていただきたいです。
